<!DOCTYPE html>
<html>
<head>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="../Scripts/layui/css/layui.css" media="all" />
</head>
<body>
    <form class="layui-form">
        <div class="layui-form-item" style="margin-top:20px">
            <label class="layui-form-label">
                原始密码
            </label>
            <div class="layui-input-inline">
                <input type="text" name="oldpwd" id="oldpwd" lay-verify="required" placeholder="请输入原始密码" autocomplete="off"
                       class="layui-input" />
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                新密码
            </label>
            <div class="layui-input-inline">
                <input type="password" name="newPwd1" id="newPwd1" lay-verify="required|pass" placeholder="请输入新密码" autocomplete="off"
                       class="layui-input" />
            </div>
            <div class="layui-form-mid layui-word-aux">
                请填写6到12位密码
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                确认新密码
            </label>
            <div class="layui-input-inline">
                <input type="password" name="newPwd2" id="newPwd2" lay-verify="required|pass" placeholder="请再次输入新密码" autocomplete="off"
                       class="layui-input" />
            </div>
            <div class="layui-form-mid layui-word-aux">
                请填写6到12位密码
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit="" lay-filter="submit">
                    立即提交
                </button>
                <button type="reset" class="layui-btn layui-btn-primary">
                    重置
                </button>
            </div>
        </div>
    </form>
    <script type="text/javascript" src="../Scripts/layui/layui.js"></script>
    <script>
        layui.use(["form"], function () {
            var form = layui.form, $ = layui.jquery;
            //自定义验证规则
            form.verify({
                pass: [/(.+){6,12}$/, '密码必须6到12位']
            });

            var _handlers = {
                getQueryString: function (name) {
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                    var r = window.location.search.substr(1).match(reg);
                    if (r != null) return unescape(r[2]); return null;
                }
            };

            form.on('submit(submit)', function (data) {
                var obj = data.field;
                var uid = _handlers.getQueryString("uid");
                var old = obj["oldpwd"];
                var n1 = obj["newPwd1"];
                var n2 = obj["newPwd2"];
                var i = layer.load(0, { shade: [0.5, '#fff'] });
                $.ajax({
                    url: "../tools/UserHandler.ashx",
                    data: { action: "editorpwd", uid: uid, old: old, n1: n1, n2: n2 },
                    dataType: "json",
                    type: "post",
                    success: function (json) {
                        layer.close(i);
                        var ii = layer.alert(json.msg, function (index) {
                            layer.close(ii);
                            if (json.status == 1) {
                                window.location.reload();
                            }
                        });
                    }, error: function () { }
                })
                return false;
            });
        })

    </script>
</body>
</html>
